# 売上管理 Webアプリ（GitHub Pages / 完全クライアントサイド）

## 概要
Uber Eats等のCSV（`trip_activity` / `payments_order`）をブラウザで読み込み、売上推移（積み上げステップチャート）と詳細表を表示します。
サーバー処理は不要で、CSVは外部へ送信しません。

## 使い方
1. `index.html`, `app.js`, `styles.css` を同一フォルダに置きます。
2. GitHub Pagesで公開する場合は、この3ファイルをリポジトリの `docs/` か root に配置してください。
3. ブラウザで開き、CSVをドラッグ&ドロップします（複数同時OK、追加ドロップでマージ）。

## 集計ルール
- 結合キー: `trip_activity` の「乗車の UUID」 ↔ `payments_order` の「乗車ID」
- 配達報酬: `payments_order` で「乗車ID」がある行の「支払い額」合計
- プロモーション: `payments_order` で「乗車ID」が空欄の行の「支払い額」合計
- 業務日付: 午前4:00 で日付切替
- 週の開始: 月曜始まり

## 注意
- CSVの列名が異なる場合は `app.js` の `findCol()` 候補を増やしてください。
- データが非常に多い場合、詳細表は描画負荷を抑えるため一部のみ表示します。


## 追加仕様
- `payments_order` の備考等に `so.payout` を含む行は「報酬支払（振込）」として売上集計から除外します。
- 期間表示:
  - 日次/週次/月次は「開始日」を指定可能（週は月曜始まり、月は1日始まりに自動補正）
  - 「期間指定」モードで開始日〜終了日（両端含む）を自由に指定
- チャート: ホイール/ピンチでズーム、Shift+ドラッグでパン、リセットボタンあり（chartjs-plugin-zoom）


## 稼働時間・時給・配達/時（推定）
- 稼働時間は「1時間単位」で推定します。
- 稼働判定は、対象期間内の **配達（乗車IDあり）** の「依頼時間（なければ降車/決済時間）」が入っている時間帯を稼働とします。
- 稼働時間帯の間に **6時間未満** の空きがある場合は「依頼が無いだけで稼働中」とみなし、その空き時間も稼働扱いにします。
- 推定値:
  - 稼働時間（h）
  - 時給 = 総売上 / 稼働時間
  - 配達/時 = 配達回数 / 稼働時間

## 非稼働時間の省略表示
- 「非稼働時間（1時間）を省略して表示」をONにすると、稼働時間帯だけを詰めてチャート表示します（X軸は稼働時間ベースの仮想軸になります）。
